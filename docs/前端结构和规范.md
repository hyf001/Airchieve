# 前端项目结构和编码规范

## 目录结构

```
frontend/
├── public/                 # 静态资源
├── src/
│   ├── main.tsx            # 应用入口
│   ├── App.tsx             # 根组件，路由配置
│   ├── App.css             # 全局样式
│   ├── index.css           # Tailwind 入口
│   ├── assets/             # 静态资源（图片等）
│   ├── components/         # 组件目录
│   │   ├── ui/             # 基础 UI 组件（shadcn/ui）
│   │   │   ├── button.tsx
│   │   │   ├── card.tsx
│   │   │   ├── dialog.tsx
│   │   │   └── ...
│   │   ├── layout/         # 布局组件
│   │   │   ├── Layout.tsx
│   │   │   ├── Header.tsx
│   │   │   ├── Sidebar.tsx
│   │   │   └── index.ts
│   │   └── workspace/      # 工作台专用组件
│   │       ├── ChatPanel.tsx
│   │       ├── ContentArea.tsx
│   │       └── DocumentSidebar.tsx
│   ├── pages/              # 页面组件
│   │   ├── index.ts        # 统一导出
│   │   ├── LandingPage.tsx # 首页
│   │   ├── WorkspacePage.tsx # 工作台页面
│   │   ├── HomePage.tsx    # 管理后台首页
│   │   ├── ChatPage.tsx    # 聊天页面
│   │   ├── ProjectsPage.tsx
│   │   ├── EvaluationPage.tsx
│   │   ├── UsersPage.tsx
│   │   └── SettingsPage.tsx
│   ├── lib/                # 工具库
│   │   ├── api.ts          # API 调用封装
│   │   └── utils.ts        # 工具函数
│   ├── hooks/              # 自定义 Hooks
│   │   └── use-toast.ts
│   └── context/            # React Context
│       └── WorkspaceContext.tsx
├── package.json
├── vite.config.ts          # Vite 配置
├── tailwind.config.js      # Tailwind 配置
├── tsconfig.json           # TypeScript 配置
└── components.json         # shadcn/ui 配置
```

## 配置文件

```
frontend/
├── .env                    # 环境变量
├── .env.example            # 环境变量示例
├── tsconfig.json           # TypeScript 配置
├── vite.config.ts          # Vite 构建配置
├── tailwind.config.js      # Tailwind CSS 配置
├── postcss.config.js       # PostCSS 配置
└── components.json         # shadcn/ui 组件配置
```

---

## 技术栈

| 技术 | 用途 |
|------|------|
| React 19 | UI 框架 |
| TypeScript | 类型安全 |
| Vite | 构建工具 |
| React Router | 路由管理 |
| TanStack Query | 服务端状态管理 |
| Tailwind CSS | 样式框架 |
| shadcn/ui | UI 组件库 |
| Radix UI | 无障碍组件原语 |
| Axios | HTTP 客户端 |
| Lucide React | 图标库 |
| Zod | 数据验证 |

---

## 路由结构

```tsx
// App.tsx
<Routes>
  {/* 公开页面 */}
  <Route path="/" element={<LandingPage />} />
  <Route path="/workspace" element={<WorkspacePage />} />

  {/* 管理后台（需要认证） */}
  <Route path="/admin" element={<Layout />}>
    <Route index element={<HomePage />} />
    <Route path="projects" element={<ProjectsPage />} />
    <Route path="chat" element={<ChatListPage />} />
    <Route path="chat/:projectId" element={<ChatPage />} />
    <Route path="evaluation" element={<EvaluationPage />} />
    <Route path="evaluation/:projectId" element={<EvaluationDetailPage />} />
    <Route path="users" element={<UsersPage />} />
    <Route path="settings" element={<SettingsPage />} />
  </Route>
</Routes>
```

**页面说明：**

| 路径 | 页面 | 说明 |
|------|------|------|
| `/` | LandingPage | 产品首页，用户入口 |
| `/workspace` | WorkspacePage | AI 文档处理工作台 |
| `/admin` | Layout | 管理后台布局容器 |
| `/admin/projects` | ProjectsPage | 项目管理 |
| `/admin/chat/:id` | ChatPage | 聊天详情页 |
| `/admin/evaluation` | EvaluationPage | 评估列表 |
| `/admin/users` | UsersPage | 用户管理 |
| `/admin/settings` | SettingsPage | 系统设置 |

---

## API 调用规范

### API 模块结构

```typescript
// src/lib/api.ts

// API 基础配置
const API_BASE_URL = import.meta.env.VITE_API_URL || 'http://localhost:8000';

export const api = axios.create({
  baseURL: API_BASE_URL,
  headers: { 'Content-Type': 'application/json' },
});

// 按模块组织 API
export const projectsApi = {
  list: (params) => api.get('/api/projects', { params }),
  get: (id) => api.get(`/api/projects/${id}`),
  create: (data) => api.post('/api/projects', data),
  // ...
};

export const chatApi = {
  getMessages: (projectId) => api.get(`/api/chat/${projectId}/messages`),
  streamChat: (projectId, question, onMessage, onError, onComplete) => {
    // SSE 流式聊天
  },
};
```

### SSE 流式 API 调用

```typescript
// 流式聊天接口调用示例
const abortController = chatApi.streamChat(
  projectId,
  question,
  // onMessage - 收到消息时
  (message: ChatStreamMessage) => {
    if (message.message_type === 'chat') {
      setContent(prev => prev + message.content);
    }
  },
  // onError - 发生错误时
  (error) => {
    console.error('Stream error:', error);
  },
  // onComplete - 完成时
  () => {
    setIsProcessing(false);
  }
);

// 取消请求
abortController.abort();
```

### 类型定义

```typescript
// API 响应类型
export interface ChatStreamMessage {
  role: string;
  message_type: 'chat' | 'thinking' | 'tool_use' | 'tool_result' | 'error';
  content: string;
  metadata_json?: Record<string, unknown>;
  conversation_id: string;
  duration_ms: number;
  token_count: number;
  cost_usd?: number;
  created_at: string;
}
```

---

## 编码规范

### 1. 文件命名

| 类型 | 规范 | 示例 |
|------|------|------|
| 组件文件 | 大驼峰 | `WorkspacePage.tsx` |
| 工具文件 | 小写短横线 | `use-toast.ts` |
| 样式文件 | 与组件同名 | `LandingPage.css` |
| 类型文件 | 小写 | `types.ts` |

### 2. 组件规范

```tsx
// 组件文件结构
import { useState, useRef, useCallback } from 'react';
import { useNavigate } from 'react-router-dom';
import { Button } from '@/components/ui/button';
import { cn } from '@/lib/utils';

// 类型定义
interface ComponentProps {
  title: string;
  onSubmit?: () => void;
}

// 组件实现
export function ComponentName({ title, onSubmit }: ComponentProps) {
  const [state, setState] = useState('');

  const handleClick = useCallback(() => {
    // 处理逻辑
  }, []);

  return (
    <div className="container">
      <h1>{title}</h1>
      <Button onClick={handleClick}>提交</Button>
    </div>
  );
}
```

**要点：**
- 使用函数式组件 + Hooks
- Props 使用 TypeScript 接口定义
- 使用命名导出（`export function`）
- 事件处理函数使用 `useCallback` 优化

### 3. 样式规范

**优先使用 Tailwind CSS：**
```tsx
// 推荐
<div className="flex items-center gap-4 p-6 bg-[#1a1a1a] rounded-2xl">

// 条件样式使用 cn()
<button className={cn(
  'px-4 py-2 rounded-lg transition-all',
  isActive
    ? 'bg-orange-500 text-white'
    : 'bg-gray-200 text-gray-600'
)}>
```

**颜色规范（深色主题）：**

| 用途 | 颜色值 | 说明 |
|------|--------|------|
| 背景色 | `#0f0f0f` | 页面背景 |
| 卡片背景 | `#1a1a1a` | 容器背景 |
| 边框色 | `#2a2a2a` | 分割线/边框 |
| 主色调 | `orange-500` ~ `amber-500` | 强调色/按钮 |
| 文字主色 | `white` | 标题文字 |
| 文字次色 | `#888` | 说明文字 |
| 文字弱色 | `#666` / `#555` | 辅助文字 |

### 4. 状态管理

**组件内状态：**
```tsx
const [messages, setMessages] = useState<Message[]>([]);
const [isLoading, setIsLoading] = useState(false);
```

**服务端状态（使用 TanStack Query）：**
```tsx
const { data, isLoading, error } = useQuery({
  queryKey: ['projects', params],
  queryFn: () => projectsApi.list(params),
});
```

**全局状态（使用 Context）：**
```tsx
// context/WorkspaceContext.tsx
export const WorkspaceContext = createContext<WorkspaceState | null>(null);

export function WorkspaceProvider({ children }) {
  const [state, setState] = useState(initialState);
  return (
    <WorkspaceContext.Provider value={{ state, setState }}>
      {children}
    </WorkspaceContext.Provider>
  );
}

// 使用
const { state } = useWorkspace();
```

### 5. 导入顺序

```tsx
// 1. React 核心
import { useState, useEffect, useCallback } from 'react';

// 2. 第三方库
import { useNavigate } from 'react-router-dom';
import { useQuery } from '@tanstack/react-query';

// 3. UI 组件
import { Button } from '@/components/ui/button';
import { Card } from '@/components/ui/card';

// 4. 图标
import { FileText, Send, Loader2 } from 'lucide-react';

// 5. 工具函数
import { cn } from '@/lib/utils';
import { chatApi } from '@/lib/api';

// 6. 类型导入
import type { ChatStreamMessage } from '@/lib/api';
```

### 6. 类型导入

```tsx
// 值导入
import { chatApi } from '@/lib/api';

// 类型导入（使用 type 关键字）
import type { ChatStreamMessage } from '@/lib/api';
```

---

## 组件分类

### UI 组件 (`components/ui/`)

基于 shadcn/ui 的基础组件，由 CLI 生成，保持原样使用。

**常用组件：**
- `Button` - 按钮
- `Card` - 卡片
- `Dialog` - 对话框
- `Input` / `Textarea` - 输入框
- `Select` - 下拉选择
- `Tabs` - 标签页
- `Toast` / `Sonner` - 提示消息
- `Skeleton` - 加载骨架

### 布局组件 (`components/layout/`)

页面布局相关组件：

- `Layout` - 管理后台主布局
- `Header` - 顶部导航栏
- `Sidebar` - 侧边栏

### 页面组件 (`pages/`)

每个页面对应一个文件，通过 `pages/index.ts` 统一导出：

```tsx
// pages/index.ts
export { HomePage } from './HomePage';
export { LandingPage } from './LandingPage';
export { WorkspacePage } from './WorkspacePage';
// ...
```

---

## 环境配置

### 环境变量

```bash
# .env
VITE_API_URL=http://localhost:8000
```

### 开发环境

```bash
# 安装依赖
npm install

# 启动开发服务器
npm run dev

# 构建生产版本
npm run build

# 预览生产构建
npm run preview
```

---

## 依赖清单

### 核心依赖

| 包名 | 版本 | 用途 |
|------|------|------|
| react | ^19.2.0 | UI 框架 |
| react-dom | ^19.2.0 | DOM 渲染 |
| react-router-dom | ^7.12.0 | 路由管理 |
| @tanstack/react-query | ^5.90.19 | 服务端状态管理 |
| axios | ^1.13.2 | HTTP 客户端 |

### UI 相关

| 包名 | 用途 |
|------|------|
| tailwindcss | CSS 框架 |
| @radix-ui/* | 无障碍组件原语 |
| lucide-react | 图标库 |
| class-variance-authority | 组件变体管理 |
| clsx + tailwind-merge | 样式合并工具 |
| sonner | Toast 通知 |
| vaul | Drawer 组件 |

### 表单与验证

| 包名 | 用途 |
|------|------|
| react-hook-form | 表单管理 |
| @hookform/resolvers | 表单验证解析器 |
| zod | 数据验证 |

### 开发依赖

| 包名 | 用途 |
|------|------|
| vite | 构建工具 |
| typescript | 类型检查 |
| eslint | 代码检查 |
| postcss | CSS 处理 |
| autoprefixer | CSS 前缀 |

---

## 最佳实践

### 1. 组件拆分原则

- 单一职责：每个组件只做一件事
- 可复用性：通用组件放入 `components/ui/`
- 页面级组件放入 `pages/`
- 业务组件放入 `components/{feature}/`

### 2. 性能优化

```tsx
// 使用 useCallback 缓存函数
const handleClick = useCallback(() => {
  // ...
}, [dependencies]);

// 使用 useMemo 缓存计算结果
const filtered = useMemo(() => {
  return items.filter(item => item.active);
}, [items]);

// 懒加载组件
const LazyComponent = lazy(() => import('./HeavyComponent'));
```

### 3. 错误处理

```tsx
// API 调用错误处理
try {
  const data = await api.get('/endpoint');
} catch (error) {
  if (axios.isAxiosError(error)) {
    toast.error(error.response?.data?.message || '请求失败');
  }
}

// SSE 流式错误处理
chatApi.streamChat(
  projectId,
  question,
  onMessage,
  (error) => {
    console.error('Stream error:', error);
    toast.error('连接中断，请重试');
  },
  onComplete
);
```

### 4. 响应式设计

```tsx
// 使用 Tailwind 响应式前缀
<div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">

// 移动端隐藏
<span className="hidden sm:inline">桌面端文字</span>
```
